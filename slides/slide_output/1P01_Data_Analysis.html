<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Brian A. Fannin" />
  <meta name="dcterms.date" content="2017-08-21" />
  <title>Data Analysis</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="1P01_Data_Analysis_files/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="1P01_Data_Analysis_files/reveal.js-3.3.0.1/css/theme/solarized.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>

    <link rel="stylesheet" href="css/revealOpts.css"/>

<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Data Analysis</h1>
    <h2 class="author">Brian A. Fannin</h2>
    <h3 class="date">August 21, 2017</h3>
</section>

<section><section id="preliminaries" class="titleslide slide level1"><h1>Preliminaries</h1></section><section id="what-well-cover" class="slide level2">
<h1>What we’ll cover</h1>
<ul>
<li>Basic data analysis in R</li>
<li>Fit a distribution</li>
<li>Linear regression</li>
</ul>
</section><section id="packages-well-use" class="slide level2">
<h1>Packages we’ll use</h1>
<ul>
<li><code>MASS</code> (MASS = Modern Applied Statistics in S)
<ul>
<li><code>fitdistr</code> will fit a distribution to a loss distribution function</li>
</ul></li>
<li><code>actuar</code> <span class="citation" data-cites="actuarPackage">(Dutang, Goulet, and Pigeon 2008)</span>
<ul>
<li><code>emm</code> calculates empirical moments</li>
<li><code>lev</code> limited expected value</li>
<li>Contains many more distributions than are found in <code>base</code> R such as Burr, Pareto, etc. Basically, anything in “Loss Models” is likely to be found here.</li>
<li>Contains the dental claims data from “Loss Models”</li>
</ul></li>
</ul>
</section><section id="generate-some-loss-data" class="slide level2">
<h1>Generate some loss data</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">8910</span>)
years &lt;-<span class="st"> </span><span class="dv">2001</span>:<span class="dv">2010</span>
frequency &lt;-<span class="st"> </span><span class="dv">1000</span>

N &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="kw">length</span>(years), frequency)

sevShape &lt;-<span class="st"> </span><span class="dv">2</span>
sevScale &lt;-<span class="st"> </span><span class="dv">1000</span>
severity &lt;-<span class="st"> </span><span class="kw">rgamma</span>(<span class="kw">sum</span>(N), sevShape, <span class="dt">scale =</span> sevScale)</code></pre></div>
</section></section>
<section><section id="basic-analysis" class="titleslide slide level1"><h1>Basic analysis</h1></section><section id="basic-exploratory-functions" class="slide level2">
<h1>Basic exploratory functions</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(severity)
## [1] 1969.549
<span class="kw">median</span>(severity)
## [1] 1640.102
<span class="kw">var</span>(severity)
## [1] 1973851
<span class="kw">sd</span>(severity)
## [1] 1404.938
<span class="kw">quantile</span>(severity, <span class="fl">0.25</span>)
##      25% 
## 928.9297
<span class="kw">quantile</span>(severity, <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))
##       25%       50%       75% 
##  928.9297 1640.1021 2676.1799</code></pre></div>
</section><section id="summary" class="slide level2">
<h1>Summary</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(severity)
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##    21.93   928.93  1640.10  1969.55  2676.18 11128.25</code></pre></div>
</section><section id="hist-again" class="slide level2">
<h1>Hist again</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(severity)</code></pre></div>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-5-1.png" width="768" /></p>
</section><section id="density-again" class="slide level2">
<h1>Density again</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">density</span>(severity))</code></pre></div>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-6-1.png" width="768" /></p>
</section><section id="basic-analysis-summary" class="slide level2">
<h1>Basic analysis summary</h1>
<p>For univariate continuous data, this is about it. Say, wouldn’t it be fun to fit this to a loss distribution?</p>
</section></section>
<section><section id="fit-a-distribution" class="titleslide slide level1"><h1>Fit a distribution</h1></section><section id="fitdistr" class="slide level2">
<h1>fitdistr</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS)

fitGamma &lt;-<span class="st"> </span><span class="kw">fitdistr</span>(severity, <span class="st">&quot;gamma&quot;</span>)
fitLognormal &lt;-<span class="st"> </span><span class="kw">fitdistr</span>(severity, <span class="st">&quot;lognormal&quot;</span>)
fitWeibull &lt;-<span class="st"> </span><span class="kw">fitdistr</span>(severity, <span class="st">&quot;Weibull&quot;</span>)

fitGamma
##       shape           rate    
##   1.981942e+00   1.006292e-03 
##  (1.261418e-02) (8.096328e-07)
fitLognormal
##      meanlog        sdlog   
##   7.312554108   0.804493446 
##  (0.008045739) (0.005689197)
fitWeibull
##       shape          scale    
##   1.472049e+00   2.184117e+03 
##  (1.117737e-02) (1.566082e+01)</code></pre></div>
</section><section id="q-q-plot-code" class="slide level2">
<h1>q-q plot code</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">probabilities =<span class="st"> </span>(<span class="dv">1</span>:(<span class="kw">sum</span>(N)))/(<span class="kw">sum</span>(N)+<span class="dv">1</span>)

weibullQ &lt;-<span class="st"> </span><span class="kw">qweibull</span>(probabilities, <span class="kw">coef</span>(fitWeibull)[<span class="dv">1</span>], <span class="kw">coef</span>(fitWeibull)[<span class="dv">2</span>])
lnQ &lt;-<span class="st"> </span><span class="kw">qlnorm</span>(probabilities, <span class="kw">coef</span>(fitLognormal)[<span class="dv">1</span>], <span class="kw">coef</span>(fitLognormal)[<span class="dv">2</span>])
gammaQ &lt;-<span class="st"> </span><span class="kw">qgamma</span>(probabilities, <span class="kw">coef</span>(fitGamma)[<span class="dv">1</span>], <span class="kw">coef</span>(fitGamma)[<span class="dv">2</span>])

sortedSeverity &lt;-<span class="st"> </span><span class="kw">sort</span>(severity)</code></pre></div>
</section><section id="q-q-plot-plotting-code" class="slide level2">
<h1>q-q plot, plotting code</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oldPar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw">plot</span>(<span class="kw">sort</span>(weibullQ), sortedSeverity, <span class="dt">xlab =</span> <span class="st">&#39;Theoretical Quantiles&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Sample Quantiles&#39;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">main =</span> <span class="st">&quot;Weibull Fit&quot;</span>)
<span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)

<span class="kw">plot</span>(<span class="kw">sort</span>(lnQ), sortedSeverity, <span class="dt">xlab =</span> <span class="st">&#39;Theoretical Quantiles&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Sample Quantiles&#39;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">main =</span> <span class="st">&quot;Lognormal Fit&quot;</span>)
<span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)

<span class="kw">plot</span>(<span class="kw">sort</span>(gammaQ), sortedSeverity, <span class="dt">xlab =</span> <span class="st">&#39;Theoretical Quantiles&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Sample Quantiles&#39;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">main =</span> <span class="st">&quot;Gamma Fit&quot;</span>)
<span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)

<span class="kw">par</span>(oldPar)</code></pre></div>
</section><section id="q-q-plot" class="slide level2">
<h1>q-q plot</h1>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-10-1.png" width="768" /></p>
</section><section id="compare-fit-to-histogram" class="slide level2">
<h1>Compare fit to histogram</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sampleLogMean &lt;-<span class="st"> </span>fitLognormal$estimate[<span class="dv">1</span>]
sampleLogSd &lt;-<span class="st"> </span>fitLognormal$estimate[<span class="dv">2</span>]

sampleShape &lt;-<span class="st"> </span>fitGamma$estimate[<span class="dv">1</span>]
sampleRate &lt;-<span class="st"> </span>fitGamma$estimate[<span class="dv">2</span>]

sampleShapeW &lt;-<span class="st"> </span>fitWeibull$estimate[<span class="dv">1</span>]
sampleScaleW &lt;-<span class="st"> </span>fitWeibull$estimate[<span class="dv">2</span>]

x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">max</span>(severity), <span class="dt">length.out=</span><span class="dv">500</span>)
yLN &lt;-<span class="st"> </span><span class="kw">dlnorm</span>(x, sampleLogMean, sampleLogSd)
yGamma &lt;-<span class="st"> </span><span class="kw">dgamma</span>(x, sampleShape, sampleRate)
yWeibull &lt;-<span class="st"> </span><span class="kw">dweibull</span>(x, sampleShapeW, sampleScaleW)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(severity, <span class="dt">freq=</span><span class="ot">FALSE</span>, <span class="dt">ylim=</span><span class="kw">range</span>(yLN, yGamma))

<span class="kw">lines</span>(x, yLN, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)
<span class="kw">lines</span>(x, yGamma, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)
<span class="kw">lines</span>(x, yWeibull, <span class="dt">col=</span><span class="st">&quot;green&quot;</span>)</code></pre></div>
</section><section id="compare" class="slide level2">
<h1>Compare</h1>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-13-1.png" width="768" /></p>
</section><section id="kolmogorov-smirnov" class="slide level2">
<h1>Kolmogorov-Smirnov</h1>
<p>The Kolmogorov-Smirnov test measures the distance between a sample distribution’s empirical cumulative distribution function and the same for a candidate loss distribution. More formal than q-q plots.</p>
<!--
## K-S

First, let's visualize that


```r
sampleCumul <- seq(1, length(severity)) / length(severity)
stepSample  <- stepfun(sortedSeverity, c(0, sampleCumul), f = 0)
yGamma <- pgamma(sortedSeverity, sampleShape, sampleRate)
yWeibull <- pweibull(sortedSeverity, sampleShapeW, sampleScaleW)
yLN <- plnorm(sortedSeverity, sampleLogMean, sampleLogSd)
```

## Plot K-S

<img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-15-1.png" width="768" />
-->
</section><section id="more-k-s" class="slide level2">
<h1>More K-S</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">testGamma &lt;-<span class="st"> </span><span class="kw">ks.test</span>(severity, <span class="st">&quot;pgamma&quot;</span>, sampleShape, sampleRate)
testLN &lt;-<span class="st"> </span><span class="kw">ks.test</span>(severity, <span class="st">&quot;plnorm&quot;</span>, sampleLogMean, sampleLogSd)
testWeibull &lt;-<span class="st"> </span><span class="kw">ks.test</span>(severity, <span class="st">&quot;pweibull&quot;</span>, sampleShapeW, sampleScaleW)

testGamma
## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  severity
## D = 0.0066186, p-value = 0.7735
## alternative hypothesis: two-sided
testLN
## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  severity
## D = 0.047763, p-value &lt; 2.2e-16
## alternative hypothesis: two-sided
testWeibull
## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  severity
## D = 0.02053, p-value = 0.0004373
## alternative hypothesis: two-sided</code></pre></div>
<p>A low value for D indicates that the selected curve is fairly close to our data. The p-value indicates the chance that D was produced by the null hypothesis.</p>
</section><section id="direct-optimization" class="slide level2">
<h1>Direct optimization</h1>
<p>The <code>optim</code> function will optimize a function. Works very similar to the Solver algorithm in Excel. <code>optim</code> takes a function as an argument, so let’s create a function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">quadraticFun &lt;-<span class="st"> </span>function(a, b, c){
  function(x) a*x^<span class="dv">2</span> +<span class="st"> </span>b*x +<span class="st"> </span>c
}

myQuad &lt;-<span class="st"> </span><span class="kw">quadraticFun</span>(<span class="dt">a=</span><span class="dv">4</span>, <span class="dt">b=</span>-<span class="dv">3</span>, <span class="dt">c=</span><span class="dv">3</span>)</code></pre></div>
</section><section id="direct-optimization-1" class="slide level2">
<h1>Direct optimization</h1>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-18-1.png" width="768" /></p>
</section><section id="direct-optimization-2" class="slide level2">
<h1>Direct optimization</h1>
<p>8 is our initial guess. A good initial guess will speed up conversion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myResult &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dv">8</span>, myQuad)
myResult
## $par
## [1] 0.4
## 
## $value
## [1] 2.44
## 
## $counts
## function gradient 
##       20       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre></div>
</section><section id="direct-optimization-3" class="slide level2">
<h1>Direct optimization</h1>
<p>Default is to minimize. Set the parameter <code>fnscale</code> to something negative to convert to a maximization problem.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myOtherQuad &lt;-<span class="st"> </span><span class="kw">quadraticFun</span>(-<span class="dv">6</span>, <span class="dv">20</span>, -<span class="dv">5</span>)
<span class="kw">plot</span>(myOtherQuad, -<span class="dv">10</span>, <span class="dv">10</span>)</code></pre></div>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-20-1.png" width="768" /></p>
</section><section id="direct-optimization-4" class="slide level2">
<h1>Direct optimization</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myResult &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dv">8</span>, myOtherQuad)
myResult
## $par
## [1] 1.447401e+75
## 
## $value
## [1] -1.256982e+151
## 
## $counts
## function gradient 
##      502       NA 
## 
## $convergence
## [1] 1
## 
## $message
## NULL
myResult &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dv">8</span>, myOtherQuad, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">fnscale=</span>-<span class="dv">1</span>))
myResult
## $par
## [1] 1.666406
## 
## $value
## [1] 11.66667
## 
## $counts
## function gradient 
##       30       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre></div>
</section><section id="direct-optimization-5" class="slide level2">
<h1>Direct optimization</h1>
<p>Direct optimization allows us to create another objective function to maximize, or work with loss distributions for which there isn’t yet support in a package like <code>actuar</code>. May be used for general purpose optimization problems, e.g. maximize rate of return for various capital allocation methods.</p>
<p>Note that optimization is a general, solved problem. Things like the simplex method already have package solutions in R. You don’t need to reinvent the wheel!</p>
</section></section>
<section><section id="linear-regression" class="titleslide slide level1"><h1>Linear regression</h1></section><section id="fake-some-data" class="slide level2">
<h1>Fake some data</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="dv">100</span>
B0 &lt;-<span class="st"> </span><span class="dv">5</span>
B1 &lt;-<span class="st"> </span><span class="fl">1.5</span>
B2 &lt;-<span class="st"> </span><span class="fl">0.8</span>

<span class="kw">set.seed</span>(<span class="dv">1234</span>)

e &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)
X1 &lt;-<span class="st"> </span><span class="kw">runif</span>(N, <span class="dv">0</span>, <span class="dv">10</span>)
X2 &lt;-<span class="st"> </span><span class="kw">runif</span>(N, <span class="dv">30</span>, <span class="dv">60</span>)
X3 &lt;-<span class="st"> </span><span class="kw">runif</span>(N, <span class="dv">200</span>, <span class="dv">300</span>)

Y &lt;-<span class="st"> </span>B0 +<span class="st"> </span>B1 *<span class="st"> </span>X1 +<span class="st"> </span>B2 *<span class="st"> </span>X2 +<span class="st"> </span>e</code></pre></div>
</section><section id="first-visualize" class="slide level2">
<h1>First, visualize!</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(X1, Y)</code></pre></div>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-23-1.png" width="768" /></p>
</section><section id="fit-a-model" class="slide level2">
<h1>Fit a model</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw">lm</span>(Y ~<span class="st"> </span>X1)
<span class="kw">summary</span>(fit)
## 
## Call:
## lm(formula = Y ~ X1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -13.5778  -5.9302  -0.6026   6.4902  11.8346 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  42.8261     1.5845  27.028  &lt; 2e-16 ***
## X1            1.2003     0.2797   4.291 4.18e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.382 on 98 degrees of freedom
## Multiple R-squared:  0.1581, Adjusted R-squared:  0.1496 
## F-statistic: 18.41 on 1 and 98 DF,  p-value: 4.184e-05</code></pre></div>
</section><section id="formulas" class="slide level2">
<h1>Formulas</h1>
<pre><code>y ~ x1
y ~ 1 + x1
y ~ 0 + x1
y ~ x1 + x2
y ~ I(x1 + x2)
y ~ x1 + x2 + x1:x2</code></pre>
<aside class="notes">
<p>Formulas place the response variable on the left and an expression to the right of the <code>~</code> character. That character may be read as “is modelled as”.</p>
<p>An intercept is implicit. To rermove it, use a “0” or “-1” in the expression</p>
<p>The “+” does not mean addition in the algebraic sense. It means we’re adding another predictor variable to our model. To use arithmetic operations, wrap expressions in I()</p>
The : is used for interactions.
</aside>
</section><section id="extract-data-from-the-fit" class="slide level2">
<h1>Extract data from the fit</h1>
<table>
<thead>
<tr class="header">
<th>Element</th>
<th>What it shows</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>residuals</td>
<td>weighted residuals</td>
</tr>
<tr class="even">
<td>coefficients</td>
<td>coefficients</td>
</tr>
<tr class="odd">
<td>sigma</td>
<td>square root</td>
</tr>
<tr class="even">
<td>df</td>
<td>degrees of freedom</td>
</tr>
<tr class="odd">
<td>fstatistic</td>
<td>The F-stat</td>
</tr>
<tr class="even">
<td>r.squared</td>
<td>r^2</td>
</tr>
<tr class="odd">
<td>adj.r.squared</td>
<td>r^2 penalized for more parameters</td>
</tr>
<tr class="even">
<td>cov.unscaled</td>
<td>covariance matrix</td>
</tr>
<tr class="odd">
<td>correlation</td>
<td>correlation matrix</td>
</tr>
</tbody>
</table>
</section><section id="predict" class="slide level2">
<h1>Predict</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prediction &lt;-<span class="st"> </span><span class="kw">predict</span>(fit)</code></pre></div>
</section><section id="visualize-prediction" class="slide level2">
<h1>Visualize prediction</h1>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-26-1.png" width="768" /></p>
</section><section id="visualize-your-residuals" class="slide level2">
<h1>Visualize your residuals!</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Y, <span class="kw">residuals</span>(fit))
<span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-27-1.png" width="768" /></p>
</section><section id="what-are-we-looking-for" class="slide level2">
<h1>What are we looking for?</h1>
<ul>
<li>Heteroskedasticity =&gt; We should change the weights applied to the observations</li>
<li>Doesn’t look like “noise”
<ul>
<li>Serial correlation =&gt; Use a time series</li>
<li>Apply a transform (polynomial, trig, etc.)</li>
</ul></li>
<li>Extreme values =&gt; A normal distribution may not be appropriate</li>
</ul>
</section><section id="try-another-fit" class="slide level2">
<h1>Try another fit</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(Y ~<span class="st"> </span>X1 +<span class="st"> </span>X2)
<span class="kw">summary</span>(fit2)
## 
## Call:
## lm(formula = Y ~ X1 + X2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.9870 -0.7513 -0.1599  0.5974  2.6735 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.56639    0.56507   8.081  1.8e-12 ***
## X1           1.43554    0.03769  38.087  &lt; 2e-16 ***
## X2           0.81316    0.01113  73.083  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.991 on 97 degrees of freedom
## Multiple R-squared:  0.985,  Adjusted R-squared:  0.9847 
## F-statistic:  3181 on 2 and 97 DF,  p-value: &lt; 2.2e-16

fit3 &lt;-<span class="st"> </span><span class="kw">lm</span>(Y ~<span class="st"> </span>X1 +<span class="st"> </span>X2 +<span class="st"> </span>X3)
<span class="kw">summary</span>(fit3)
## 
## Call:
## lm(formula = Y ~ X1 + X2 + X3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.9146 -0.7446 -0.1878  0.6012  2.6461 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  5.343254   1.121556   4.764 6.73e-06 ***
## X1           1.434152   0.037800  37.940  &lt; 2e-16 ***
## X2           0.812640   0.011165  72.782  &lt; 2e-16 ***
## X3          -0.002941   0.003665  -0.802    0.424    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.9928 on 96 degrees of freedom
## Multiple R-squared:  0.9851, Adjusted R-squared:  0.9846 
## F-statistic:  2113 on 3 and 96 DF,  p-value: &lt; 2.2e-16</code></pre></div>
</section></section>
<section><section id="questions" class="titleslide slide level1"><h1>Questions</h1></section><section id="questions-1" class="slide level2">
<h1>Questions</h1>
<ul>
<li>Plot a lognormal distribution with a mean of $10,000 and a CV of 30%.</li>
<li>For that distribution, what is the probability of seeing a claim greater than $100,000?</li>
<li>Generate 100 and 1,000 observations from that distribution.</li>
<li>Draw a histogram for each sample.</li>
<li>What are the mean, standard deviation and CV of each sample?</li>
<li>Convince yourself that the sample data were not produced by a Weibull distribution.</li>
<li>Assuming that losses are Poisson distributed, with expected value of 200, estimate the aggregate loss distribution.</li>
<li>What is the cost of a $50,000 xs $50,000 layer of reinsurance?</li>
</ul>
</section><section id="answers" class="slide level2">
<h1>Answers</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">severity &lt;-<span class="st"> </span><span class="dv">10000</span>
CV &lt;-<span class="st"> </span>.<span class="dv">3</span>
sigma &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">log</span>(<span class="dv">1</span> +<span class="st"> </span>CV^<span class="dv">2</span>))
mu &lt;-<span class="st"> </span><span class="kw">log</span>(severity) -<span class="st"> </span>sigma^<span class="dv">2</span>/<span class="dv">2</span>
<span class="kw">plot</span>(function(x) <span class="kw">dlnorm</span>(x), mu, sigma, <span class="dt">ylab=</span><span class="st">&quot;LN f(x)&quot;</span>)</code></pre></div>
<p><img src="1P01_Data_Analysis_files/figure-revealjs/unnamed-chunk-29-1.png" width="768" /></p>
</section><section id="references" class="slide level2 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-actuarPackage">
<p>Dutang, Christophe, Vincent Goulet, and Mathieu Pigeon. 2008. “Actuar: An R Package for Actuarial Science.” <em>Journal of Statistical Software</em> 25 (7): 38. <a href="http://www.jstatsoft.org/v25/i07" class="uri">http://www.jstatsoft.org/v25/i07</a>.</p>
</div>
</div>
</section></section>
    </div>
  </div>

  <script src="1P01_Data_Analysis_files/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="1P01_Data_Analysis_files/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Transition style
        transition: 'slide', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom



        // Optional reveal.js plugins
        dependencies: [
          { src: '1P01_Data_Analysis_files/reveal.js-3.3.0.1/plugin/notes/notes.js', async: true },
          { src: '1P01_Data_Analysis_files/reveal.js-3.3.0.1/plugin/zoom-js/zoom.js', async: true },
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
